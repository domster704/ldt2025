# Лидеры Цифровой Трансформации 2025 | Решение команды МИСИС Два Миллиона

Веб-сервис предиктивной аналитики физиологических данных с интеграцией в медицинское оборудование.

## Основные ссылки

- [Ссылка на рабочий прототип](https://front.lct2025.ln-kr.ru/)
- [Скринкаст работы сервиса](https://disk.yandex.ru/d/mrFo2GxYHhY-zA)
- [Презентация](https://disk.yandex.ru/d/mrFo2GxYHhY-zA)

---

## Как развернуть?

1. Заполнить `.env` файлы по примерам из `.env.example` в:
    - `lct2025`
    - `lct2025-backend/run`

2. В корне `lct2025` запустить скрипт `update.sh`
    ```bash
    bash update.sh    
    ```
3. `lct2025-llm` надо запустить отдельно не в Docker контейнере:
    ```bash
    python main.py
    ```

---

## Руководство пользователя

Руководство пользователя для нашего приложения можно найти в файле `docs/user_experience.md`

## Архитектура решения

### Сервисы

#### Веб-интерфейс мониторинга

Выступает главным сервисом для взаимодействия с медицинским персоналом через **удобный интерфейс мониторинга КТГ**, построенном на WebSocket соединении. Позволяет в реальном времени отслеживать физиологические показатели плода, получать предупреждения о патологических состояниях и сохранять историю исследований.

#### Основное API

Реализует все методы для **получения предсказаний** и **формирования отчетов по КТГ**. В качестве протокола общения наше API предоставляет **HTTP REST API** и **WebSocket**, что позволяет легко интегрировать сервис в любую внешнюю медицинскую систему или использовать как самостоятельное решение.

**[Документация к api](https://api.lct2025.ln-kr.ru/docs)**

#### ML Engine

Сервис для обработки **физиологических сигналов в реальном времени**. Реализует алгоритмы анализа кардиотокографии, включая прогнозирование риска гипоксии плода, анализ вариабельности сердечного ритма (STV) и классификацию по стандартам FIGO, Савельевой, Фишеру. Использует обученные модели CatBoost и scikit-learn для обеспечения высокой точности диагностики.

#### Streaming Service

Все данные от медицинского оборудования проходят через сервис потоковой обработки, который **принимает сигналы FHR и UC, обрабатывает их в реальном времени и передает результаты анализа**. Данные автоматически фильтруются и анализируются с использованием пороговых значений и ML-моделей.

```mermaid
flowchart LR
    subgraph Devices ["Медицинские устройства"]
        CTG["CTG Аппарат"]
    end

    subgraph Backend ["Backend (FastAPI)"]
        API["REST API + WebSocket"]
        DB[("PostgreSQL/SQLite")]
        ML["ML Engine (PyTorch, Sklearn)"]
        MIGR["Alembic (миграции)"]
    end

    subgraph Frontend ["Frontend (React + Redux Toolkit)"]
        UI["UI Dashboard"]
        WebsocketClient["WS Client"]
        State["Redux Store"]
    end

    CTG --> |Сигналы FHR/UC| API
    API -->  DB
    API -->  ML
    API -->  Frontend
    WebsocketClient -->  API
    UI -->  State
```

## ML

### Стек технологий

Python, scikit-learn, CatBoost, Pandas, NumPy

### Преимущества

1) Реальное время обработки сигналов КТГ с минимальной задержкой
2) Высокая точность прогнозирования риска гипоксии плода
3) Автоматическая классификация по стандартам FIGO
4) Анализ вариабельности сердечного ритма (STV) с прогнозированием до 10 минут вперед
5) Обнаружение патологических паттернов (тахикардия, брадикардия, акцелерации, децелерации)
6) Интеграция с медицинским оборудованием через удобный интерфейс
7) Безопасность медицинских данных пациентов

### Реализация

Система обрабатывает два основных типа сигналов:

- **FHR (Fetal Heart Rate)** - частота сердечных сокращений плода
- **UC (Uterine Contractions)** - сокращения матки

Что делали мы:  
Обучались на реальных данных КТГ с различными патологическими состояниями. Используем комбинацию пороговых алгоритмов для быстрого обнаружения критических состояний и ML-моделей для более точного анализа и прогнозирования.

### Signal Processing

#### Real-time Analysis

**Модель для анализа сигналов в реальном времени**  
Поскольку КТГ данные поступают непрерывно, мы используем скользящее окно для анализа последних 600 секунд данных. Это
позволяет обнаруживать патологические паттерны в реальном времени.

#### Hypoxia Prediction

**Модель для предсказания риска гипоксии**  
Используем CatBoost модель, обученную на исторических данных КТГ с исходами гипоксии плода. Модель анализирует
комбинацию факторов: базовую частоту сердечных сокращений, вариабельность, наличие акцелераций и децелераций.

#### STV Forecasting

**Прогнозирование краткосрочной вариабельности**  
Используем CatBoost модель, обученную на ретро данных на непрерывной переменной STV в будущем, для прогнозирования STV
на 3, 5 и 10 минут вперед. Это помогает врачам предвидеть изменения в состоянии плода намного раньше.

#### Pattern Recognition

**Обнаружение патологических паттернов**  
Пороговые алгоритмы для обнаружения:

- Тахикардии (>160 уд/мин)
- Брадикардии (<110 уд/мин)
- Акцелераций (повышение ЧСС на >15 уд/мин)
- Децелераций (снижение ЧСС на >15 уд/мин)

#### Classification

**Классификация по стандартам FIGO**  
Автоматическая классификация состояния плода согласно международным стандартам FIGO на основе анализа всех параметров КТГ.

**Классификация по Савельевой и по Фишеру**  
Также были релизована классификация по Савельевой и по Фишеру, как альтернатива FIGO

### Метрики качества

* ROC-AUC прогноза гипоксии ≈ 0.80.
* F1-score (по результатам обследования) = 0.73
* MAE прогноза STV <  1.2 мс.

## Backend

### Стек технологий

- **Python**: основной язык, на котором написан сервис
- **FastAPI**: современный веб-фреймворк для создания высокопроизводительных API
- **SQLAlchemy**: ORM для работы с базой данных
- **WebSocket**: протокол для передачи данных в реальном времени
- **Alembic**: система миграций базы данных
- **Dishka**: система внедрения зависимостей
- **Pydantic**: валидация данных и сериализация

### Преимущества

Благодаря модульной архитектуре, основной функционал нашего решения может быть легко интегрирован в существующие медицинские системы или использоваться как самостоятельное решение.

В качестве протокола общения используется HTTP REST API и WebSocket, что позволяет быстро создать интеграции с различными медицинскими системами и устройствами.

Был сделан большой упор на безопасность (данные надежно защищены), оптимизации под небольшие мощности и соответствие медицинским стандартам.

### Поддержка:

Поддержка CTG-аппаратов может быть осуществленна через

    * USB/COM (Raw данные).
    * HL7/FHIR API (клинические системы).
    * Wi-Fi / локальную сеть (стриминг JSON).

Сигналы конвертируются в `StreamData` и подаются в WebSocket.

## Потребление памяти

Благодаря оптимизациям в сервисах удалось добиться небольшого потребления памяти, что позволит запускать приложение даже на небольших мощностях

![image](/docs/pics/docker_usage.png "docker usage")

## Frontend

### Стек технологий

- **TypeScript**: Статическая типизация для JavaScript.
- **React**: Компонентная библиотека для создания UI.
- **Redux Toolkit**: Управление состоянием приложения.
- **VisX/D3**: Библиотеки для создания интерактивных графиков КТГ.

## Исходный код проекта

- Фронт: `lct2025-front/src`
- Бэк и ML: `lct2025-backend/src`
- Сервис суммаризации `lct2025-llm`

## Состав команды

- **[Степан Пискунов](https://t.me/parkiev)** - backend, captain
- **[Григорий Исупов](https://t.me/domster704)** - frontend
- **[Андрей Кадомцев](https://t.me/avenircs)** - ML
- **[Светлана Шубина](https://t.me/gleamhaze)** - design, product manager

---
